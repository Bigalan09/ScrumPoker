<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scrum Voting Poker</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/8.6.1/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/8.6.1/firebase-auth.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-database.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-firestore.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-functions.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-messaging.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-storage.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-analytics.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-remote-config.js"></script>
  <script defer src="/__/firebase/8.6.1/firebase-performance.js"></script>
  <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap"
    rel="stylesheet">
  <link href="css/main.css" type="text/css" rel="stylesheet" />
</head>

<body>
  <div class="wrapper">
    <h1 class="title">Scrum Voting Poker</h1>
    <div class="row">
      <div class="col mr-1">
        <h2>Players</h2>
        <ul>
          <li>Alan</li>
        </ul>
      </div>
      <div class="col cards fb-50">
        <div class="row">
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb0" /><label for="cb0">0</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb1" /><label for="cb1">0.5</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb2" /><label for="cb2">1</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb3" /><label for="cb3">2</label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb4" /><label for="cb4">3</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb5" /><label for="cb5">5</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb6" /><label for="cb6">8</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb7" /><label for="cb7">13</label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb8" /><label for="cb8">20</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb9" /><label for="cb9">40</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb10" /><label for="cb10">?</label>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <input type="radio" name="card" id="cb11" /><label for="cb11">â˜•</label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <canvas id="myChart" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
      <div class="col fb-20 ml-1">
        <div class="row fd-c">
          <div class="col">
            <input type="text" id="room-identifier" placeholder="Room Name" readonly />
          </div>
          <div class="col">
            <button class="button start">Start Voting</button>
            <button class="button finish">Finish Voting</button>
          </div>
          <div class="col">
            &nbsp;
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.2.1/dist/chart.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });
      // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
      // firebase.firestore().doc('/foo/bar').get().then(() => { });
      // firebase.functions().httpsCallable('yourFunction')().then(() => { });
      // firebase.messaging().requestPermission().then(() => { });
      // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
      // firebase.analytics(); // call to activate
      // firebase.analytics().logEvent('tutorial_completed');
      // firebase.performance(); // call to activate
      //
      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

      try {
        let app = firebase.app();
        let features = [
          'auth',
          'database',
          'firestore',
          'functions',
          'messaging',
          'storage',
          'analytics',
          'remoteConfig',
          'performance',
        ].filter(feature => typeof app[feature] === 'function');

        init(app);

      } catch (e) {
        console.error(e);
        loadEl.textContent = 'Error loading the Firebase SDK, check the console.';
      }
    });

    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;

      // Avoid scrolling to bottom
      textArea.style.top = "0";
      textArea.style.left = "0";
      textArea.style.position = "fixed";

      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      try {
        var successful = document.execCommand('copy');
        var msg = successful ? 'successful' : 'unsuccessful';
        console.log('Fallback: Copying text command was ' + msg);
      } catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
      }

      document.body.removeChild(textArea);
    }

    function copyTextToClipboard(text) {
      if (!navigator.clipboard) {
        fallbackCopyTextToClipboard(text);
        return;
      }
      navigator.clipboard.writeText(text).then(function () {
        console.log('Async: Copying to clipboard was successful!');
      }, function (err) {
        console.error('Async: Could not copy text: ', err);
      });
    }

    const generatePushID = (function () {
      // Modeled after base64 web-safe chars, but ordered by ASCII.
      var PUSH_CHARS = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';

      // Timestamp of last push, used to prevent local collisions if you push twice in one ms.
      var lastPushTime = 0;

      // We generate 72-bits of randomness which get turned into 12 characters and appended to the
      // timestamp to prevent collisions with other clients.  We store the last characters we
      // generated because in the event of a collision, we'll use those same characters except
      // "incremented" by one.
      var lastRandChars = [];

      return function () {
        var now = new Date().getTime();
        var duplicateTime = (now === lastPushTime);
        lastPushTime = now;

        var timeStampChars = new Array(8);
        for (var i = 7; i >= 0; i--) {
          timeStampChars[i] = PUSH_CHARS.charAt(now % 64);
          // NOTE: Can't use << here because javascript will convert to int and lose the upper bits.
          now = Math.floor(now / 64);
        }
        if (now !== 0) throw new Error('We should have converted the entire timestamp.');

        var id = timeStampChars.join('');

        if (!duplicateTime) {
          for (i = 0; i < 12; i++) {
            lastRandChars[i] = Math.floor(Math.random() * 64);
          }
        } else {
          // If the timestamp hasn't changed since last push, use the same random number, except incremented by 1.
          for (i = 11; i >= 0 && lastRandChars[i] === 63; i--) {
            lastRandChars[i] = 0;
          }
          lastRandChars[i]++;
        }
        for (i = 0; i < 12; i++) {
          id += PUSH_CHARS.charAt(lastRandChars[i]);
        }
        if (id.length != 20) throw new Error('Length should be 20.');

        return id;
      };
    })();

    const init = (app) => {
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      const roomId = urlParams.get('roomid');
      const id = roomId || generatePushID();

      const roomNameElement = document.querySelector('#room-identifier');
      roomNameElement.value = `${window.location.origin}?roomid=${id}`;

      roomNameElement.addEventListener('click', () => {
        roomNameElement.focus();
        roomNameElement.select();
        copyTextToClipboard(roomNameElement.value);
      })

      initChart();
    };

    const initChart = () => {
      const ctx = document.getElementById('myChart').getContext('2d');
      const myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
          datasets: [{
            label: '# of Votes',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: [
              'rgb(255, 99, 132)',
              'rgb(54, 162, 235)',
              'rgb(255, 206, 86)',
              'rgb(75, 192, 192)',
              'rgb(153, 102, 255)',
              'rgb(255, 159, 64)'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          plugins:
          {
            legend: {
              position: 'right',
            },
            title: {
              display: false,
            }
          }
        }
      });
    };
  </script>
</body>

</html>